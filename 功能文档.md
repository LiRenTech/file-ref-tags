# VSCode File Ref Tags 插件功能文档

## 1. 项目概述

### 1.1 项目简介
File Ref Tags 是一个 VSCode 扩展插件，用于管理和快速访问代码引用。它允许用户将文件、代码片段添加到引用面板中，并通过点击快速跳转到对应的位置，提高开发效率。

### 1.2 主要功能
- 添加当前文件到引用面板
- 添加当前文件+选中的代码片段到引用面板
- 添加当前选中的全局唯一片段到引用面板
- 拖拽排序引用项
- 点击快速跳转到引用位置
- 查看和管理所有引用项

## 2. 安装与配置

### 2.1 安装方式
- 从 VSCode 扩展市场搜索 "file-ref-tags" 并安装
- 或下载 .vsix 文件手动安装

### 2.2 配置项
目前插件无需额外配置，安装即可使用。

## 3. 功能使用说明

### 3.1 打开引用面板
在 VSCode 活动栏中点击 "File Ref Tags" 图标，打开引用面板。

### 3.2 添加引用项

#### 3.2.1 添加当前文件
- 打开需要添加的文件
- 右键点击编辑器，选择 "FileRefTags" -> "添加当前文件到面板"
- 或使用命令面板 (Ctrl+Shift+P) 输入 "FileRefTags: 添加当前文件到面板"

#### 3.2.2 添加文件+代码片段
- 打开文件，选中需要添加的代码片段
- 右键点击编辑器，选择 "FileRefTags" -> "添加当前文件+选中的片段到面板"
- 或使用命令面板输入 "FileRefTags: 添加当前文件+选中的片段到面板"

#### 3.2.3 添加全局唯一片段
- 打开文件，选中需要添加的代码片段
- 右键点击编辑器，选择 "FileRefTags" -> "添加当前选中的全局唯一片段到面板"
- 或使用命令面板输入 "FileRefTags: 添加当前选中的全局唯一片段到面板"
- 插件会自动搜索整个工作区，确保该片段是唯一的

#### 3.2.4 复制链接（vscode:// 协议）

插件提供了 5 个命令用于将 vscode:// 协议链接复制到剪贴板，方便在外部文档、邮件或其他应用中创建可跳转的链接：

- **复制链接（仅代码片段）**
  - 右键点击编辑器，选择 "FileRefTags" -> "复制链接（仅代码片段）"
  - 格式：`vscode://lirentech.file-ref-tags?snippet=<代码片段>`
  - 适用于代码片段全局唯一的情况

- **复制链接（仅文件名）**
  - 右键点击编辑器，选择 "FileRefTags" -> "复制链接（仅文件名）"
  - 格式：`vscode://lirentech.file-ref-tags?filePath=<文件名>`
  - 适用于仅需要跳转到文件的情况

- **复制链接（文件名+代码片段）**
  - 右键点击编辑器，选择 "FileRefTags" -> "复制链接（文件名+代码片段）"
  - 或使用快捷键：`Cmd+Shift+Option+C` (Mac) / `Ctrl+Shift+Alt+C` (Windows/Linux)
  - 格式：`vscode://lirentech.file-ref-tags?filePath=<文件名>&snippet=<代码片段>`
  - 适用于文件名唯一且需要定位到特定代码片段的情况

- **复制链接（父级文件夹+文件名+代码片段）**
  - 右键点击编辑器，选择 "FileRefTags" -> "复制链接（父级文件夹+文件名+代码片段）"
  - 格式：`vscode://lirentech.file-ref-tags?filePath=<父级文件夹>/<文件名>&snippet=<代码片段>`
  - 适用于有同名文件但父级文件夹不同的情况

- **复制链接（项目级路径+代码片段）**
  - 右键点击编辑器，选择 "FileRefTags" -> "复制链接（项目级路径+代码片段）"
  - 格式：`vscode://lirentech.file-ref-tags?filePath=<项目相对路径>&snippet=<代码片段>`
  - 适用于需要完整项目路径的情况，路径相对于工作区根目录

### 3.3 管理引用项

#### 3.3.1 跳转到引用
- 在引用面板中点击任意引用项，即可跳转到对应的文件或代码片段

#### 3.3.2 拖拽排序
- 在引用面板中，拖拽引用项可以调整其顺序
- 排序后的数据会自动保存

#### 3.3.3 删除引用项
- 在引用面板中，点击引用项右侧的 "×" 按钮即可删除

### 3.4 查看存储位置
- 在引用面板中，点击 "Show Storage Location" 按钮
- 插件会在文件资源管理器中显示存储引用数据的 JSON 文件

## 4. 技术架构

### 4.1 核心组件

#### 4.1.1 ReferenceDataManager
- 负责引用数据的加载、保存和管理
- 数据存储在 VSCode 扩展的全局存储目录下的 `references.json` 文件中
- 支持添加、删除、排序引用项

#### 4.1.2 FileRefTagsViewProvider
- 提供 Webview 视图，用于显示和管理引用项
- 处理与 Webview 之间的消息通信
- 实现跳转到引用位置的逻辑

### 4.2 数据结构

引用项的数据结构如下：
```typescript
interface ReferenceItem {
  id: string;              // 唯一标识符
  type: 'file' | 'file-snippet' | 'global-snippet' | 'comment';  // 引用类型
  title: string;           // 显示标题
  filePath?: string;       // 文件路径（仅file和file-snippet类型）
  snippet?: string;        // 代码片段（仅file-snippet和global-snippet类型）
  comment?: string;        // 注释（仅comment类型）
  createdAt: string;       // 创建时间
  updatedAt: string;       // 更新时间
}
```

### 4.3 工作流程

1. 用户通过命令或右键菜单添加引用项
2. ReferenceDataManager 将引用项保存到本地 JSON 文件
3. FileRefTagsViewProvider 通知 Webview 更新引用列表
4. 用户在 Webview 中查看、排序或删除引用项
5. 用户点击引用项，插件跳转到对应的文件或代码片段

## 5. 命令列表

| 命令名称 | 命令ID | 描述 | 快捷键 |
|---------|-------|------|--------|
| 添加当前文件到面板 | file-ref-tags.addCurrentFile | 将当前打开的文件添加到引用面板 | - |
| 添加当前文件+选中的片段到面板 | file-ref-tags.addFileAndSnippet | 将当前文件和选中的代码片段添加到引用面板 | - |
| 添加当前选中的全局唯一片段到面板 | file-ref-tags.addGlobalUniqueSnippet | 将选中的全局唯一片段添加到引用面板 | - |
| 添加用户注释到面板 | file-ref-tags.addComment | 添加自定义注释到引用面板 | - |
| 复制链接（仅代码片段） | file-ref-tags.copyLinkSnippetOnly | 复制仅包含代码片段的 vscode:// 链接 | - |
| 复制链接（仅文件名） | file-ref-tags.copyLinkFileNameOnly | 复制仅包含文件名的 vscode:// 链接 | - |
| 复制链接（文件名+代码片段） | file-ref-tags.copyLinkFileNameAndSnippet | 复制包含文件名和代码片段的 vscode:// 链接 | Cmd+Shift+Option+C (Mac)<br>Ctrl+Shift+Alt+C (Win/Linux) |
| 复制链接（父级文件夹+文件名+代码片段） | file-ref-tags.copyLinkParentDirAndSnippet | 复制包含父级文件夹、文件名和代码片段的 vscode:// 链接 | - |
| 复制链接（项目级路径+代码片段） | file-ref-tags.copyLinkWorkspacePathAndSnippet | 复制包含项目相对路径和代码片段的 vscode:// 链接 | - |
| Hello World | file-ref-tags.helloWorld | 扩展示例命令 | - |

## 6. 扩展点

### 6.1 视图容器
- 活动栏图标：显示插件图标
- 视图容器ID：`file-ref-tags-view-container`

### 6.2 Webview 视图
- 视图ID：`file-ref-tags.list-view`
- 视图名称：References List
- 用于显示和管理引用项

### 6.3 右键菜单
- 在编辑器右键菜单中添加了 "FileRefTags" 子菜单，包含所有引用相关命令
- 支持通过右键菜单快速访问所有功能

### 6.4 快捷键
- **复制链接（文件名+代码片段）**：`Cmd+Shift+Option+C` (Mac) / `Ctrl+Shift+Alt+C` (Windows/Linux)
  - 在编辑器中有焦点且非只读状态下可用
  - 需要先选中代码片段才能使用

## 7. 数据存储

- 存储位置：VSCode 扩展的全局存储目录
- 文件名：`references.json`
- 存储格式：JSON
- 数据备份：用户可通过查看存储位置手动备份

## 8. 性能与限制

### 8.1 性能考虑
- 全局搜索时，会忽略 `node_modules` 目录
- 全局搜索最多搜索 10000 个文件，避免性能问题
- 代码片段搜索使用简单的字符串匹配

### 8.2 限制
- 全局唯一片段功能依赖于工作区搜索，可能受限于文件数量
- 代码片段过长时，显示会被截断
- 不支持跨工作区共享引用数据

## 9. 开发与调试

### 9.1 开发环境
- Node.js
- TypeScript
- ESBuild
- VSCode 扩展开发工具包

### 9.2 构建命令
```bash
# 开发构建
pnpm run compile

# 监听模式
pnpm run watch

# 生产构建
pnpm run package
```

### 9.3 调试
- 使用 VSCode 的 "Run Extension" 配置启动调试
- 使用 "Extension Tests" 配置运行测试

## 10. 未来规划

- [x] 支持自定义引用项标题
- [x] 支持添加注释类型的引用项
- [x] 支持复制 vscode:// 协议链接
- [x] 支持快捷键快速复制链接
- [ ] 支持分组管理引用项
- [ ] 支持导出和导入引用数据
- [ ] 支持跨工作区引用
- [ ] 支持搜索和过滤引用项
- [ ] 支持自动检测和更新引用项

## 11. 已知问题

- 全局搜索可能在大型项目中较慢
- 代码片段变更后，引用项不会自动更新
- 不支持特殊字符例如“&”的精确匹配

---

**版本**: 0.0.3  
**更新日期**: 2025-12-21  
**适用 VSCode 版本**: ^1.107.0

## 13. 版本更新记录

### v0.0.4

- 支持不同的类vscode编辑器中导出链接，例如trae
- 支持白色主题

### v0.0.3
- 新增 5 个复制 vscode:// 协议链接的命令
  - 复制链接（仅代码片段）
  - 复制链接（仅文件名）
  - 复制链接（文件名+代码片段）
  - 复制链接（父级文件夹+文件名+代码片段）
  - 复制链接（项目级路径+代码片段）
- 为"复制链接（文件名+代码片段）"命令添加快捷键：`Cmd+Shift+Option+C` (Mac) / `Ctrl+Shift+Alt+C` (Windows/Linux)

### v0.0.2
- 添加通过 vscode:// 协议的外部 URL 支持
- 支持文件路径的绝对路径、相对路径和仅文件名
- 当多个文件匹配时添加代码片段筛选
- 改进错误处理，提供详细的错误信息

### v0.0.1
- 初始版本
- 支持添加文件、文件+片段、全局片段和注释
- 支持拖拽排序和快速跳转
- 支持编辑引用项标题
- 支持不同类型引用项的颜色区分